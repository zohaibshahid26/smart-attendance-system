<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Attendance System</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-5">
    <h1 class="text-3xl font-bold text-blue-600 mb-6">Smart Attendance System</h1>

    <div class="bg-white p-6 shadow-lg rounded-lg w-full max-w-md text-center">
        <h2 class="text-xl font-semibold mb-4">Register User</h2>
        <input type="text" id="name" placeholder="Enter Name" class="border p-2 rounded w-full mb-2">
        <input type="file" id="imageInput" accept="image/*" class="border p-2 rounded w-full mb-2">
        <button onclick="registerUser()" class="bg-blue-500 text-white px-4 py-2 rounded">Register</button>
    </div>

    <div class="bg-white p-6 shadow-lg rounded-lg w-full max-w-md mt-6 text-center">
        <h2 class="text-xl font-semibold mb-4">Mark Attendance</h2>
        <a href="/mark_attendance" class="bg-green-500 text-white px-4 py-2 rounded">Start Attendance</a>
    </div>

    <div class="bg-white p-6 shadow-lg rounded-lg w-full max-w-md mt-6 text-center">
        <h2 class="text-xl font-semibold mb-4">Attendance Records</h2>
        <button onclick="fetchAttendance()" class="bg-purple-500 text-white px-4 py-2 rounded">View Attendance</button>
        <ul id="attendanceList" class="mt-4 text-left"></ul>
    </div>

    <script>
        function registerUser() {
            let name = document.getElementById("name").value;
            let file = document.getElementById("imageInput").files[0];
            if (!name || !file) {
                alert("Please enter a name and select an image.");
                return;
            }
            let reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
                let imageData = reader.result.split(',')[1];
                $.ajax({
                    url: "/register",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ name: name, image: imageData }),
                    success: function (response) {
                        alert(response.message);
                    },
                    error: function (xhr, status, error) {
                        alert(xhr.responseJSON?.error || "Error: " + status + " - " + error);
                    }
                });
            };
        }

        function fetchAttendance() {
            $.get("/get_attendance", function (data) {
                let list = document.getElementById("attendanceList");
                list.innerHTML = "";
                data.forEach(record => {
                    let item = document.createElement("li");
                    item.textContent = `${record.name} - ${record.timestamp}`;
                    list.appendChild(item);
                });
            });
        }
    </script>
</body>

</html>